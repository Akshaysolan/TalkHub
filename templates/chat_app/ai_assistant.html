{% extends 'chat_app/base.html' %}
{% block title %}AI Chat{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3><i class="fas fa-robot"></i> AI ChatGPT</h3>
    <div id="chatBox" class="border p-3 rounded mb-3" 
         style="height: 400px; overflow-y: auto; background: #f8f9fa;">
    </div>

    <div class="input-group mb-3">
        <input type="text" id="userInput" class="form-control" placeholder="Type your message...">
        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
function sendMessage() {
    let input = document.getElementById("userInput");
    let chatBox = document.getElementById("chatBox");

    let userMsg = input.value.trim();
    if (!userMsg) return;

    chatBox.innerHTML += `<p><b>You:</b> ${userMsg}</p>`;
    input.value = "";

    fetch("{% url 'chat_app:ai_chat' %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
        body: new URLSearchParams({ "message": userMsg })
    })
    .then(res => res.json())
    .then(data => {
        chatBox.innerHTML += `<p><b>AI:</b> ${data.reply}</p>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    });
}
</script>
{% endblock %}
